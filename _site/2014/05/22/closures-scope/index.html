<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title>
      
        Closures &amp; Scope &middot; PCS
      
    </title>

    <script type="text/javascript" src="../scripts/jquery-2.1.0.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="../css/master.css">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  </head>

  <body class="pure-g">
    <header class="pure-u-1">
      <nav class="pure-menu pure-menu-open pure-menu-horizontal">
        <ul>
          <li>
            <a href="/">JavaScript Evening</a>
          </li>
          <li>
            <a id="" href="/">About</a>
          </li>
          

          
          
            
              
            
          
            
              
                <li>
                  <a id="" href="/syllabus/">Syllabus</a>
                </li>
              
            
          
            
              
            
          
            
              
                <li>
                  <a id="" href="/curriculum/">Curriculum</a>
                </li>
              
            
          
            
          
            
              
                <li>
                  <a id="" href="/resources/">Resources</a>
                </li>
              
            
          
          <li>
            <a href="http://portlandcodeschool.com/" class="nav-item">PCS Home</a>
          </li>
        </ul>
      </nav>      
    </header>

    <section class="pure-u-1">
      <div class="post">
  <h1 class="post-title">Closures &amp; Scope</h1>
  <span class="post-date">22 May 2014</span>
  <span class="post-slides">

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

</span>

  <p>Understanding <em>closures</em> and <em>scope</em> will help us really understand what&#39;s
going on when we use variables inside and outside of functions.</p>

<p>You may already be using closures and scope effectively without knowing it! We
now just need to attach some terms so that you have a common vocabulary to
discuss these concepts with other programmers.</p>

<h2>Scope</h2>

<p>Scope is the term that we use to define where variables are usable.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var add = function(x, y) {
  var result;
  result = x + y;
  return result;
};
var subtract = function(x, y) {
  var result;
  result = x - y;
  return result;
};

// insert code to call add &amp; subtract</code></pre></div>

<p>In the above example, <code>x</code>, <code>y</code>, and <code>result</code> are the names of variables that
are defined in two different functions.</p>

<p>Let&#39;s ask some questions in order to better understand scope:</p>

<ul>
<li>What will happen if we <code>console.log(z)</code> (where the comment is)?</li>
<li>What will happen if we <code>console.log(x)</code>?</li>
<li>What will happen if we <code>console.log(x)</code> before a call to <code>add</code>?</li>
<li>What if we do it after?</li>
<li>What if we <code>console.log(result)</code> before <code>var result;</code>?</li>
<li>What if we <code>console.log(result)</code> after <code>var result;</code>?</li>
<li>What if we <code>console.log(result)</code> and call <code>add</code> more than once?</li>
<li>What if we remove <code>var result;</code>? Will anything change? If so, why?</li>
<li>What if we re-define subtract to be <code>result = add(x, -y)</code>?</li>
</ul>

<p>Here&#39;s another example:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var x = 0;
var foo = function(x) {
  var bar = function(x) {
    return x;
  };
  return bar(x);
};
console.log(foo(x));</code></pre></div>

<p>How can you access the first use of <code>x</code> inside of <code>bar</code>? Because you&#39;ve
re-defined what that variable means in a <em>new scope</em>, you cannot.</p>

<p>This is called shadowing. In this case, it&#39;s not a big deal. In general, you
should try to avoid shadowing variables, though, as you may come back to your
code later and not understand why using <code>x</code> doesn&#39;t get you the first <code>x</code> that
you declared (because you missed the fact that there&#39;s a later declaration of
<code>x</code>).</p>

<h2>Closures</h2>

<p>Closures are basically functions that reference variables that are defined
outside of their scope. Here&#39;s an example:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var x = 0;
var fn = function() {
  return x;
};</code></pre></div>

<p>Formally, <code>x</code> is referred to as a <em>free variable</em> or <em>non-local variable</em>.
Functions that have free variables are <em>closures</em>, and those that have no
free variables are <em>pure</em>.</p>

<h3>Challenge</h3>

<ul>
<li>Write a function that generates the next number each time it&#39;s called:</li>
</ul>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">sequence(); //=&gt; 0
sequence(); //=&gt; 1
sequence(); //=&gt; 2</code></pre></div>

<ul>
<li>Write a function, <code>counter</code> that returns your sequence generator:</li>
</ul>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var sequence1 = counter();
var sequence2 = counter();
sequence1(); //=&gt; 0
sequence1(); //=&gt; 1
sequence2(); //=&gt; 0
sequence1(); //=&gt; 2
sequence2(); //=&gt; 1</code></pre></div>

<ul>
<li>Allow your counter to start at any number, for instance, <code>counter(5)</code>.</li>
<li>Allow your counter to be rest:</li>
</ul>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var sequence1 = counter();
var sequence2 = counter();
sequence1.next(); //=&gt; 0
sequence1.next(); //=&gt; 1
sequence2.next(); //=&gt; 0
sequence1.next(); //=&gt; 2
sequence1.reset(); //=&gt; void
sequence1.next(); //=&gt; 0
sequence2.next(); //=&gt; 1
sequence1.reset(5); //=&gt; void
sequence1.next(); //=&gt; 5</code></pre></div>

<h2>Advanced Scope</h2>

<h3>The <code>var</code> keyword</h3>

<p>Let&#39;s look at some examples to really understand <code>var</code>.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var foo = 1;
function bar() {
  if (!foo) {
    var foo = 10;
  }
  console.log(foo);
}
bar();</code></pre></div>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var a = 1;
function b() {
  a = 10;
  return;
  function a() {}
}
b();
console.log(a);</code></pre></div>

<p>The above examples are taken (and slightly modified) from this excellent
article on <a href="http://www.adequatelygood.com/JavaScript-Scoping-and-Hoisting.html"><em>hoisting</em></a>.</p>

<p>The main consideration is that any time you use <code>var</code>, you can consider that
variable to be declared at the top of the function in which it&#39;s defined. Some
JS programmers will, therefore, always put their <code>var</code> declarations in that
location to avoid any potential confusion.</p>

<p>Here&#39;s another gotcha:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var array = [&quot;hello&quot;, &quot;world&quot;];
var callbacks = [];
for (var i = 0; i &lt; array.length; i++) {
  callbacks.push(function() {
    console.log(array[i]);
  });
}
callbacks.forEach(function(c) { c(); });</code></pre></div>

<ul>
<li>What&#39;s the intended result of this code?</li>
<li>What&#39;s the actual result of this code?</li>
<li>How can you avoid this gotcha?</li>
</ul>

<p><aside>
  <strong><code>let</code></strong></p>

<p>The <code>let</code> keyword will be added in ES6 and will allow us to define
  block-scope variables. This will make JavaScript a bit more similar to other
  programming languages and address some of the gotchas above.
</aside></p>

<h3>Immediately invoked function expressions</h3>

<p>It&#39;s possible to create an environment, or scope, to protect a set of variables
from access. This is used frequently by JavaScript programmers.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var greet = (function() {
  var greeting = &quot;Hello, &quot;;

  return function(personName) {
    console.log(greeting + personName);
  };
})();

greet(&#39;Whitney&#39;);</code></pre></div>

<p>Note that <code>sayHello</code> is set to a function that actually returns a function. The
inner function is the one that&#39;s called later with <code>greet(&#39;Whitney&#39;)</code>. The
<code>greeting</code> variable is not accessible outside of the scope created by the
immediately invoked function expression. This example is a bit contrived, but
we&#39;ll start using these soon.</p>

<h2>Takeaway</h2>

<p>These concepts are simple and logical. If all of the vocabulary didn&#39;t make
sense on this pass, don&#39;t worry too much about it. Generally if your code is
well written, you won&#39;t really need to think about scope or think too hard
about what a closure is. It will be  handy to understand the terminology to
discuss this with other programmers, though.</p>

</div>



    </section>

    <footer class="pure-u-1">
      &copy; 2014. All rights reserved.
      <span>v0.0.1</span>
    </footer>
  </body>
</html>
