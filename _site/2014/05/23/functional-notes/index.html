<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">

  <head>
    <link href="http://gmpg.org/xfn/11" rel="profile">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">

    <!-- Enable responsiveness on mobile devices-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

    <title>
      
        Functional Programming Notes &middot; PCS
      
    </title>

    <script type="text/javascript" src="../scripts/jquery-2.1.0.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" type="text/css" href="../css/master.css">

    <!-- RSS -->
    <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
  </head>

  <body class="pure-g">
    <header class="pure-u-1">
      <nav class="pure-menu pure-menu-open pure-menu-horizontal">
        <ul>
          <li>
            <a href="/">JavaScript Evening</a>
          </li>
          <li>
            <a id="" href="/">About</a>
          </li>
          

          
          
            
              
            
          
            
              
                <li>
                  <a id="" href="/syllabus/">Syllabus</a>
                </li>
              
            
          
            
              
            
          
            
              
                <li>
                  <a id="" href="/curriculum/">Curriculum</a>
                </li>
              
            
          
            
          
            
              
                <li>
                  <a id="" href="/resources/">Resources</a>
                </li>
              
            
          
          <li>
            <a href="http://portlandcodeschool.com/" class="nav-item">PCS Home</a>
          </li>
        </ul>
      </nav>      
    </header>

    <section class="pure-u-1">
      <div class="post">
  <h1 class="post-title">Functional Programming Notes</h1>
  <span class="post-date">23 May 2014</span>
  <span class="post-slides">

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

  

</span>

  <h2>Class Flow</h2>

<ul>
<li>Go through each of the different functions and discuss</li>
<li>If short on time, consider skipping <code>once</code> and/or <code>filter</code> and have the
students do these during the final challenge.</li>
</ul>

<h2>Memoize</h2>

<ol>
<li>Show the Fibonacci code.</li>
<li>Ask if anyone knows why it&#39;s slow (before they answer, make sure they didn&#39;t
know the answer before class started). The expectation is that no one knows
why.</li>
<li>Discuss why it may be slow. Talk through what the computer has to do step by
step. Have someone come write on the board to show the sequence of events.</li>
<li>Show the tracing program below and explain how it works.</li>
<li>Count the number of occurrences of calculating a sub-result using <code>grep</code>.
You&#39;ll have to briefly explain <code>grep</code> and regular expressions and note that
we&#39;ll come back to regular expressions soon.</li>
<li>Discuss how to make it faster &mdash; don&#39;t re-calculate a sub result when
we&#39;ve already calculated it once.</li>
<li>Continue with the code below.</li>
</ol>

<p>Here&#39;s a tracing program for the Fibonacci sequence:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var fibonacci = function(n, indent) {
  var pad = function(n) {
    var res = &#39;&#39;;
    for (var i = 0; i &lt; n; i++) {
      res += &#39; &#39;;
    }
    return res;
  };
  if (n &gt; 1) {
    console.log(&#39;%sfibonacci(%d) -&gt; fibonacci(%d) + fibonacci(%d)&#39;, pad(indent), n, n-1, n-2);
    return fibonacci(n - 1, indent + 1) + fibonacci(n - 2, indent + 1);
  }
  else {
    return n;
  }
};
console.log(fibonacci(Number(process.argv[2]), 0));</code></pre></div>

<p>Show how the tracing program works by showing it with a low number:</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash">node fibonacci.js 3
node fibonacci.js 4
node fibonacci.js 5

node fibonacci.js 20
node fibonacci.js 20 | grep &quot;fibonacci\(8\) -&gt;&quot;
node fibonacci.js 20 | grep &quot;fibonacci\(8\) -&gt;&quot; | wc -l</code></pre></div>

<p>Start by getting to this:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var cache = {};
var factorial = function(n) {
  if (!cache[n]) {
    cache[n] = n === 0 ? 1 : n * factorial(n - 1);
  }
  return cache[n];
};</code></pre></div>

<p>Then use an immediately invoked function expression to get to this state
before moving over to abstracting the <code>memoize</code> function.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var fibonacci = (function() {
  var cache = {};
  return function(n) {
    if (!cache[n]) {
      cache[n] = n &gt; 1 ? fibonacci(n - 1) + fibonacci(n - 2) : 1;
    }
    return cache[n];
  };
})();</code></pre></div>

<p>Factorial doesn&#39;t have the same performance problem, but let&#39;s imagine that it
did for the sake of simplicity. Here&#39;s what a version with caching might look
like:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var factorial = (function() {
  var cache = {};
  return function(n) {
    if (!cache[n]) {
      cache[n] = n === 0 ? 1 : n * factorial(n - 1);
    }
    return cache[n];
  };
})();</code></pre></div>

<p>Allow students to try to abstract the <code>memoize</code> function on their own. This
could be quite a challenge. In the end, the <code>memoize</code> function should look
like this (for a single argument):</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var memoize = function(fn) {
  var cache = {};
  return function(arg) {
    return cache[arg] || (cache[arg] = fn(arg));
  };
};
var fibonacci = memoize(function(n) {
  return n &gt; 1 ? fibonacci(n - 1) + fibonacci(n - 2) : 1;
});</code></pre></div>

<p>For reference, eventually, we&#39;ll get it to this, but for now we aren&#39;t going to
talk about <code>apply</code>:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var memoize = function(fn) {
  var cache = {};
  var slice = Array.prototype.slice;
  return function () {
    var args = slice.call(arguments, 0);
    var key = JSON.stringify(args);
    return cache[key] ||
      (cache[key] = fn.apply(this, args));
  };
};</code></pre></div>

<h2>Partial Application</h2>

<p>We won&#39;t get all the way through partial applications since we can&#39;t, <code>call</code>,
<code>apply</code>, and <code>arguments</code>.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var partial = function(fn, arg1) {
  return function(arg2) {
    return fn(arg1, arg2);
  };
};

var greet = function(greeting, name) {
  return greeting + &#39; &#39; + name;
};

var hi = partial(greet, &#39;hi&#39;);

console.log(hi(&#39;Whitney&#39;));</code></pre></div>

<p>Show an example of what it would mean to handle 3 arguments (below), and note
that it only handles the case where one argument is provided to the <code>partial</code>
call and the other two are provided to the resulting function. This isn&#39;t very
flexible.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var partial = function(fn, arg1) {
  return function(arg2, arg3) {
    return fn(arg1, arg2, arg3);
  };
};

var greet = function(greeting, firstName, lastName) {
  return greeting + &#39; &#39; + firstName + &#39; &#39; + lastName;
};

var hi = partial(greet, &#39;hi&#39;);

console.log(hi(&#39;Whitney&#39;, &#39;Young&#39;));</code></pre></div>

<h2>Reduce</h2>

<p>This one will probably be pretty tricky. Take it really slowly through each one
of the examples. Try to get the students to realize that the following things
are shared between each code base:</p>

<ul>
<li>An input array</li>
<li>A result value set to some initial value</li>
<li>Alteration of the result value for each item in the array</li>
</ul>

<p>If you&#39;re feeling that there&#39;s some time, and you feel that people weren&#39;t
totally confused by <code>curry</code>, you could implement the <code>reduce</code> function to
really give them understanding of how it works. Or you could have them do it,
too. It looks like this:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">var fold = function(array, fn, start) {
  array.forEach(function(item) {
    start = fn(start, item);
  });
  return start;
};</code></pre></div>

<p>This is the solution to the reduce/fold challenge:</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">_.reduce(pairs, function(obj, pair) {
  obj[pair[0]] = pair[1];
  return obj;
}, {});

var zipObject = _.partialRight(_.reduce, function(obj, pair) {
  obj[pair[0]] = pair[1];
  return obj;
}, {});</code></pre></div>

<h2>Final Challenge</h2>

<p>Have the students present their function that they studied. Have them teach
about how it works and what it does. Politely correct only those details that
matter. Ignore minor things that may not be right.</p>

<p>Have them present their code and implementation if they wrote any. Ask them to
discuss challenges and difficulties they faced while implementing their version
(even if they didn&#39;t get it done). If they didn&#39;t get it done, ask them how
they might implement it.</p>

<p>If need be, have this spill over into the next day. If it&#39;s on the next day,
have the students reflect on whether it was easy to remember everything that
they did from the previous day.</p>

<h2>Promises</h2>

<p>This was an attempt to try to show what promises could do for callback flow and
how you might build that on your own. The promise implementation here isn&#39;t
very good and I&#39;m not sure it&#39;s illustrative either. This probably would be bad
to use even when discussing promises later. I&#39;m putting it in here in case it
ever becomes useful later.</p>

<div class="highlight"><pre><code class="language-javascript" data-lang="javascript">// save as promise.js
// echo &quot;promise.js&quot; &gt; filename.txt
// node promise.js filename.txt

var fs = require(&#39;fs&#39;);

// fs.readFile(process.argv[2], { encoding: &#39;utf8&#39; }, function(err, fileName) {
//   fs.readFile(fileName.trim(), { encoding: &#39;utf8&#39; }, function(err, contents) {
//     console.log(contents);
//   });
// });


var readFile = function(file, options) {
  var promise = {};

  promise.thenCallbacks = [];
  promise.errorCallback = function(err) { throw new Error(err) };
  promise.then = function(callback) {
    promise.thenCallbacks.push(callback);
    return promise;
  };
  promise.error = function(callback) {
    promise.errorCallback = callback;
    return promise;
  };

  fs.readFile(file, options, function(err, data) {
    var success = promise.thenCallbacks.shift();
    if (err) { promise.errorCallback(err); }
    else {
      var result = success(data);
      var thenable = (result &amp;&amp; typeof result.then === &#39;function&#39;);
      if (thenable) {
        result.thenCallbacks = promise.thenCallbacks;
        result.errorCallback = promise.errorCallback;
      }
    }
  });

  return promise;
};

readFile(process.argv[2], { encoding: &#39;utf8&#39; })
.then(function(fileName) {
  return readFile(fileName.trim(), { encoding: &#39;utf8&#39; });
})
.then(function(contents) {
  console.log(contents);
});</code></pre></div>


</div>



    </section>

    <footer class="pure-u-1">
      &copy; 2014. All rights reserved.
      <span>v0.0.1</span>
    </footer>
  </body>
</html>
